# 执行计划

> **Parent Issue**: #66
> **创建时间**: 2026-02-13
> **状态**: draft

## 元信息

- **Parent Issue**: #66
- **Spec文档**: [需求规格说明书](../docs/specs/issue-66.md)
- **总任务数**: 3
- **当前状态**: draft
- **最后更新**: 2026-02-13

## 任务列表

本计划包含 3 个任务，按顺序执行。每个任务完成后才会开始下一个任务。

### 任务等级说明

- **l1 (自动合并)**: 仅修改文档、测试或其他安全路径，CI通过后自动合并
- **l2 (命令批准)**: CI通过后需要协作者使用 `/approve-task` 命令批准合并
- **l3 (人工审查)**: 需要完整的PR Review流程，可能涉及敏感文件或复杂变更

### 任务详情

| ID | 标题 | 等级 | 依赖 | 验收标准 |
|----|------|------|------|----------|
| task-setup-game-structure | 创建game目录结构并配置uv项目 | l1 | [] | game目录已创建，pyproject.toml配置完成，uv可正常使用 |
| task-implement-snake-game | 实现贪吃蛇游戏核心逻辑 | l2 | [task-setup-game-structure] | 游戏可以运行，包含蛇的移动、食物生成、碰撞检测等基础功能 |
| task-add-documentation | 添加游戏说明文档 | l1 | [task-implement-snake-game] | README.md已创建，包含清晰的安装和运行说明 |

### YAML 机器契约（必须）

请确保 `plans/issue-66.yaml` 使用固定 machine keys：

- 顶层必填：`tasks`
- task 必填：`id`, `title`, `level`, `deps`, `acceptance`
- 无依赖必须写 `deps: []`
- 运行态字段 `status`、`issue`、`pr` 由系统状态评论维护，禁止写入 plan YAML

最小合法示例：

```yaml
tasks:
  - id: task-setup-env
    title: "初始化项目环境"
    level: l1
    deps: []
    acceptance: "项目结构创建完成并可安装依赖"
    notes: "可选"
```

禁止键（命中即失败）：`dependencies`, `acceptance_criteria`, `risk_level` 以及中文键名（如 `依赖`, `验收标准`, `风险等级`）。

---

## 任务1: 创建game目录结构并配置uv项目

**ID**: `task-setup-game-structure`  
**等级**: l1  
**状态**: draft  
**预估工作量**: Small

### 描述

创建game目录作为Python游戏项目的根目录，并使用uv初始化Python项目。配置项目基本信息和依赖管理。

### 验收标准

- [x] game目录已在项目根目录创建
- [x] pyproject.toml文件已创建并配置完成
- [x] pygame依赖已添加到项目配置中
- [x] uv可以正常识别和管理项目

### 依赖

- 依赖任务: 无
- 前置条件: 系统已安装uv工具

### 实现要点

- 在项目根目录创建game目录
- 使用`uv init`初始化Python项目
- 在pyproject.toml中添加pygame依赖
- 配置项目基本信息（名称、版本、Python版本要求等）
- 确保项目结构符合Python项目规范

### 测试要求

- 验证uv可以正常安装依赖
- 验证目录结构正确

### 关联资源

- Runtime 状态：由 `<!-- agent-state:json -->` 维护

---

## 任务2: 实现贪吃蛇游戏核心逻辑

**ID**: `task-implement-snake-game`  
**等级**: l2  
**状态**: draft  
**预估工作量**: Medium

### 描述

实现一个简单的贪吃蛇游戏，包含游戏的核心逻辑和基础功能。使用pygame库实现图形界面和游戏循环。

### 验收标准

- [x] 游戏可以通过`uv run`命令启动
- [x] 游戏窗口正常显示，界面清晰
- [x] 可以使用方向键（上下左右）控制蛇的移动
- [x] 蛇吃到食物后会增长
- [x] 食物被吃掉后在新位置重新生成
- [x] 撞墙时游戏结束并显示提示
- [x] 撞到自己时游戏结束并显示提示

### 依赖

- 依赖任务: task-setup-game-structure
- 前置条件: game目录结构已创建，pygame依赖已配置

### 实现要点

- 创建主游戏文件（如snake.py或game.py）
- 实现游戏主循环（初始化、事件处理、更新、渲染）
- 实现蛇对象：
  - 蛇的初始位置和长度
  - 蛇的移动逻辑
  - 蛇的增长逻辑
  - 蛇的渲染
- 实现食物对象：
  - 食物的随机生成
  - 食物的渲染
  - 避免食物生成在蛇身上
- 实现输入处理：
  - 监听方向键输入
  - 防止反向移动（180度转向）
- 实现碰撞检测：
  - 检测蛇头与边界的碰撞
  - 检测蛇头与蛇身的碰撞
- 实现游戏结束逻辑：
  - 显示游戏结束提示
  - 退出或重启选项（可选）

### 测试要求

- 手动测试游戏基本功能：启动、移动、吃食物、游戏结束
- 测试边界情况：快速转向、连续吃食物、撞墙等
- 确保游戏运行流畅，无明显bug

### 关联资源

- Runtime 状态：由 `<!-- agent-state:json -->` 维护

---

## 任务3: 添加游戏说明文档

**ID**: `task-add-documentation`  
**等级**: l1  
**状态**: draft  
**预估工作量**: Small

### 描述

在game目录下创建README.md文档，提供清晰的游戏说明、安装步骤和运行方法。

### 验收标准

- [x] README.md文件已在game目录下创建
- [x] 文档包含游戏简介
- [x] 文档包含环境要求说明
- [x] 文档包含安装步骤（使用uv）
- [x] 文档包含运行方法
- [x] 文档包含游戏操作说明

### 依赖

- 依赖任务: task-implement-snake-game
- 前置条件: 游戏已实现并可运行

### 实现要点

- 创建README.md文件
- 编写游戏简介
- 说明环境要求（Python版本、uv工具）
- 提供详细的安装步骤：
  - 如何安装uv
  - 如何安装项目依赖
- 提供运行方法：
  - 使用uv运行游戏的命令
- 说明游戏操作：
  - 方向键控制
  - 游戏规则

### 测试要求

- 按照README说明测试安装和运行流程
- 确保文档准确无误

### 关联资源

- Runtime 状态：由 `<!-- agent-state:json -->` 维护

---

## 风险与注意事项

### 整体风险

- pygame库在某些系统上可能需要额外的系统依赖（如SDL库）
- uv工具的版本兼容性问题
- 游戏性能在低配置机器上可能不佳

### 关键路径

关键路径：task-setup-game-structure → task-implement-snake-game → task-add-documentation

所有任务都在关键路径上，任何任务的延迟都会影响整体进度。

### 阻塞点

可能的阻塞点：
- pygame安装失败：提供备选方案或详细的安装说明
- 游戏逻辑bug：预留调试时间
- 性能问题：简化游戏逻辑或降低帧率

## 执行策略

### 串行执行

本计划采用严格串行执行策略：
- 同一时间只有一个任务处于 `in-progress` 状态
- 任务必须按照ID顺序执行
- 前一个任务完成并合并后，才会开始下一个任务

### 失败处理

如果任务失败：
1. 任务进入 `blocked` 状态
2. 系统等待人工介入（使用 `/retry` 命令重试或 `/abort` 终止）
3. 修复后可以继续执行

### 暂停/恢复

- 使用 `/pause` 命令暂停任务派发
- 使用 `/resume` 命令恢复任务派发
- 暂停期间不会创建新的任务PR

## 进度追踪

### 状态定义

- **pending**: 任务等待开始
- **in-progress**: 任务正在执行（Copilot已被分配）
- **in-review**: 任务PR已创建，等待审查/合并
- **blocked**: 任务被阻塞，需要人工介入
- **done**: 任务已完成并合并
- **cancelled**: 任务被取消

### 更新机制

本文档是计划定义文档；运行态（任务状态、Issue、PR）由 Epic Issue 下的状态评论维护。

---

**注意**: `plans/issue-66.yaml` 仅用于定义任务。运行态请以 `<!-- agent-state:json -->` 为准。
