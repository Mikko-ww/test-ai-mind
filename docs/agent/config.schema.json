{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "GitHub Agent Configuration Schema",
  "type": "object",
  "required": ["copilot", "paths", "labels", "merge_policy", "ci", "timeouts", "notifications", "commands", "retry", "reconciliation", "state"],
  "properties": {
    "copilot": {
      "type": "object",
      "required": ["bot_assignee", "bot_login_allowlist", "base_branch"],
      "properties": {
        "bot_assignee": {
          "type": "string",
          "description": "Bot username for issue assignment via REST API"
        },
        "bot_login_allowlist": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Allowed bot login names for PR author matching"
        },
        "base_branch": {
          "type": "string",
          "description": "Default base branch for Copilot PRs"
        }
      }
    },
    "paths": {
      "type": "object",
      "required": ["spec_dir", "plan_yaml_dir", "plan_md_dir"],
      "properties": {
        "spec_dir": {"type": "string"},
        "plan_yaml_dir": {"type": "string"},
        "plan_md_dir": {"type": "string"}
      }
    },
    "labels": {
      "type": "object",
      "required": ["parent", "task", "level", "pr", "special"],
      "properties": {
        "parent": {
          "type": "object",
          "required": ["requested", "spec_in_progress", "spec_approved", "plan_in_progress", "plan_approved", "executing", "done", "blocked", "paused"]
        },
        "task": {
          "type": "object",
          "required": ["task", "pending", "in_progress", "in_review", "done", "blocked", "cancelled"]
        },
        "level": {
          "type": "object",
          "required": ["l1", "l2", "l3"]
        },
        "pr": {
          "type": "object",
          "required": ["spec", "plan", "task", "status"]
        },
        "special": {
          "type": "object",
          "required": ["probe"]
        }
      }
    },
    "merge_policy": {
      "type": "object",
      "required": ["l1", "sensitive_globs", "max_changed_files_l1"],
      "properties": {
        "l1": {
          "type": "object",
          "required": ["allowlist_globs"],
          "properties": {
            "allowlist_globs": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        },
        "sensitive_globs": {
          "type": "array",
          "items": {"type": "string"}
        },
        "max_changed_files_l1": {
          "type": "integer",
          "minimum": 1
        }
      }
    },
    "ci": {
      "type": "object",
      "required": ["mode", "workflow", "required_check_name", "commands"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["dispatch"]
        },
        "workflow": {"type": "string"},
        "required_check_name": {"type": "string"},
        "commands": {
          "type": "object",
          "properties": {
            "lint": {"type": "string"},
            "test": {"type": "string"}
          }
        }
      }
    },
    "timeouts": {
      "type": "object",
      "required": ["spec_pr_minutes", "plan_pr_minutes", "task_pr_minutes", "ci_minutes"],
      "properties": {
        "spec_pr_minutes": {"type": "integer", "minimum": 1},
        "plan_pr_minutes": {"type": "integer", "minimum": 1},
        "task_pr_minutes": {"type": "integer", "minimum": 1},
        "ci_minutes": {"type": "integer", "minimum": 1}
      }
    },
    "notifications": {
      "type": "object",
      "required": ["github", "webhook"],
      "properties": {
        "github": {
          "type": "object",
          "required": ["enabled"],
          "properties": {
            "enabled": {"type": "boolean"}
          }
        },
        "webhook": {
          "type": "object",
          "required": ["enabled"],
          "properties": {
            "enabled": {"type": "boolean"},
            "secret_name": {"type": "string"},
            "url_secret_name": {"type": "string"}
          }
        }
      }
    },
    "commands": {
      "type": "object",
      "required": ["approve_task", "pause", "resume", "retry", "abort"],
      "properties": {
        "approve_task": {"type": "string"},
        "pause": {"type": "string"},
        "resume": {"type": "string"},
        "retry": {"type": "string"},
        "abort": {"type": "string"}
      }
    },
    "retry": {
      "type": "object",
      "required": ["max_retries", "delay_mins"],
      "properties": {
        "max_retries": {"type": "integer", "minimum": 0},
        "delay_minutes": {"type": "integer", "minimum": 1}
      }
    },
    "reconciliation": {
      "type": "object",
      "required": ["schedule", "auto_fix_enabled"],
      "properties": {
        "schedule": {"type": "string"},
        "auto_fix_enabled": {"type": "boolean"}
      }
    },
    "state": {
      "type": "object",
      "required": ["marker", "max_version_retries", "concurrency_group"],
      "properties": {
        "marker": {"type": "string"},
        "max_version_retries": {"type": "integer", "minimum": 1},
        "concurrency_group": {"type": "string"}
      }
    }
  }
}
