# 简化需求提交流程使用指南

## 概述

简化需求提交流程允许您通过简单的描述快速创建需求，由 Copilot 自动生成完整的需求文档供您审批。

## 新增流程

### 原有流程（标准需求提交）

```
用户提交详细需求 → Spec生成 → Plan生成 → 任务执行
```

### 新增流程（简化需求提交）

```
用户简单描述 → 需求文档生成 → 审批 → Spec生成 → Plan生成 → 任务执行
```

## 使用方法

### 1. 创建简化需求

1. 进入 Issues → New Issue
2. 选择 "💡 简化需求提交 - Simple Request" 模板
3. 填写以下内容：
   - **需求描述**: 简单描述您想要实现什么功能
   - **用意/目标**: 说明为什么需要这个功能
   - **补充信息**（可选）: 其他有助于理解的信息

### 2. 等待需求文档生成

- Copilot 会在 5-10 分钟内生成一份完整的需求文档
- 需求文档包含：
  - 需求概述
  - 背景分析
  - 功能范围
  - 用户故事
  - 功能需求
  - 非功能需求
  - 技术方案建议
  - 验收标准
  - 风险评估
  - 实施建议

### 3. 审批需求文档

- 查看 Copilot 创建的 PR（标题：`[Requirement] Issue #X: ...`）
- 审查需求文档内容
- 如果满意，合并 PR
- 如果需要修改，在 PR 中提出意见

### 4. 后续流程

需求文档审批通过后，系统会自动：
1. 生成 Spec（需求规格说明书）
2. 生成 Plan（执行计划）
3. 创建并执行任务

## 新增标签

### agent:requirement-in-progress
- **颜色**: 🔵 Blue
- **描述**: Copilot 正在生成需求文档
- **使用场景**: 简化需求提交后，等待需求文档生成

### agent:requirement-approved
- **颜色**: 🟢 Green
- **描述**: 需求文档已审批通过
- **使用场景**: 需求文档 PR 合并后

### agent:requirement-pr
- **颜色**: 🟠 Orange
- **描述**: 需求文档 PR
- **使用场景**: 标识需求文档相关的 PR

## 配置说明

### 新增配置项

在 `.github/agent/config.yml` 中新增：

```yaml
paths:
  requirement_dir: "docs/requirements"  # 需求文档存放目录
  
labels:
  parent:
    requirement_in_progress: "agent:requirement-in-progress"
    requirement_approved: "agent:requirement-approved"
  pr:
    requirement: "agent:requirement-pr"

timeouts:
  requirement_pr_minutes: 10  # 需求文档生成超时时间
```

## 工作流说明

### 新增工作流

1. **agent-requirement-approval.yml**
   - 触发条件: 需求文档 PR 合并
   - 功能: 更新标签，触发 Spec 生成

### 修改的工作流

1. **agent-intake.yml**
   - 新增: 支持简化需求提交（`<!-- agent-simple-request -->`）
   - 新增: 根据请求类型分配不同的任务（requirement/spec）

### 新增脚本

1. **add-comment.js**: 添加评论到 Issue
2. **update-labels.js**: 更新 Issue 标签（添加和移除）

## 示例

### 简化需求示例

**需求描述**:
```
我希望在用户登录后能够看到个性化的欢迎消息，显示用户名和上次登录时间。
```

**用意/目标**:
```
- 提升用户体验，让用户感受到个性化服务
- 增加用户粘性，提高留存率
```

### 生成的需求文档

Copilot 会自动生成包含以下内容的完整需求文档：
- 详细的需求概述
- 背景分析和业务价值
- 明确的功能范围
- 用户故事和验收标准
- 技术方案建议
- 风险评估和实施建议

## 对比：标准 vs 简化

| 特性 | 标准需求提交 | 简化需求提交 |
|------|------------|------------|
| 填写内容 | 详细（背景、范围、验收标准等） | 简单（描述、用意） |
| 适用场景 | 需求明确，细节清晰 | 需求初步，需要细化 |
| 审批环节 | 1次（Spec） | 2次（需求文档 + Spec） |
| 生成时间 | 直接生成 Spec（20分钟） | 需求文档（10分钟）+ Spec（20分钟） |
| 灵活性 | 低（需要详细填写） | 高（简单描述即可） |

## 注意事项

1. **选择合适的模板**
   - 如果需求已经很明确，使用标准需求提交
   - 如果需求还不够清晰，使用简化需求提交

2. **审批需求文档**
   - 仔细审查 Copilot 生成的需求文档
   - 确保功能范围和验收标准符合预期
   - 必要时提出修改意见

3. **后续流程**
   - 需求文档审批后，流程与标准需求提交相同
   - 可以使用相同的命令（/pause, /resume, /abort）

## 故障排查

### 需求文档未生成

**症状**: 10分钟后仍未看到需求文档 PR

**解决方案**:
1. 检查 Issue 是否有 `agent:requirement-in-progress` 标签
2. 查看 agent-intake.yml 工作流日志
3. 确认 Copilot 已启用
4. 检查 AGENT_GH_TOKEN 权限

### 需求文档不符合预期

**症状**: 生成的需求文档内容不准确

**解决方案**:
1. 在 PR 中提出具体的修改意见
2. 或关闭 PR，在原 Issue 中补充更多信息
3. 或切换到标准需求提交模板，提供更详细的信息

## 更新日志

### 2025-02-02
- ✅ 新增简化需求提交模板
- ✅ 新增需求文档生成功能
- ✅ 新增需求文档审批工作流
- ✅ 更新配置文件支持新流程
- ✅ 新增相关标签和脚本
