# 需求规格说明书

> **Issue**: #30
> **创建时间**: 2026-02-11
> **状态**: 草稿

## 背景与目标

### 业务背景

在项目中需要添加一些有趣的Python小游戏示例，以展示Python编程的实用性和趣味性。贪吃蛇游戏作为经典的编程练习项目，能够帮助开发者学习：
- 游戏循环和事件处理
- 基本的图形界面编程
- 碰撞检测和游戏逻辑
- Python项目结构和依赖管理

选择uv作为Python包管理工具，是为了利用其快速、可靠的特性，简化项目依赖管理。

### 目标

实现一个简单但完整的Python贪吃蛇游戏，作为项目的游戏示例模块。

**主要目标：**
- 在项目根目录创建game目录，存放Python小游戏
- 实现一个可玩的贪吃蛇游戏
- 使用uv管理Python依赖
- 保持游戏实现简单，易于理解和维护

**成功指标：**
- 游戏可以正常启动和运行
- 游戏具备基本的贪吃蛇玩法（移动、吃食物、增长、碰撞检测）
- 代码结构清晰，易于阅读
- 使用uv可以顺利安装依赖和运行游戏

## 范围（包含/不包含）

### 包含在本需求中

- ✅ 创建game目录结构
- ✅ 实现基础贪吃蛇游戏逻辑（蛇的移动、食物生成、碰撞检测）
- ✅ 使用简单的色块显示游戏画面
- ✅ 键盘方向键控制
- ✅ 基本的分数统计
- ✅ 使用uv配置Python项目（pyproject.toml）
- ✅ 简单的README说明文档

### 不包含在本需求中

- ❌ 图片、音效等多媒体资源
- ❌ 复杂的游戏功能（如难度等级、暂停菜单、排行榜等）
- ❌ 多人游戏模式
- ❌ 游戏存档功能
- ❌ 高级图形效果（动画、特效等）
- ❌ 移动端或Web版本

## 用户故事/使用场景

### 用户故事1：启动游戏

**作为** 开发者/玩家  
**我想要** 能够快速启动贪吃蛇游戏  
**以便** 进行游戏或学习代码

**验收标准：**
- [ ] 可以通过简单的命令启动游戏（如 `uv run python snake.py`）
- [ ] 游戏窗口正确显示
- [ ] 游戏初始状态正确（蛇在初始位置，食物已生成）

### 用户故事2：控制蛇移动

**作为** 玩家  
**我想要** 使用方向键控制蛇的移动方向  
**以便** 引导蛇吃到食物

**验收标准：**
- [ ] 按上下左右方向键可以改变蛇的移动方向
- [ ] 蛇不能立即掉头（如向右移动时不能直接向左）
- [ ] 蛇以恒定速度移动

### 用户故事3：吃食物和增长

**作为** 玩家  
**我想要** 蛇吃到食物后身体变长并得分  
**以便** 体验游戏的挑战和成就感

**验收标准：**
- [ ] 蛇头碰到食物时，食物消失
- [ ] 蛇的身体增加一节
- [ ] 分数增加
- [ ] 新的食物在随机位置生成

### 用户故事4：游戏结束条件

**作为** 玩家  
**我想要** 明确的游戏结束条件  
**以便** 知道何时失败并可以重新开始

**验收标准：**
- [ ] 蛇头撞到边界时游戏结束
- [ ] 蛇头撞到自己的身体时游戏结束
- [ ] 游戏结束时显示最终分数
- [ ] 可以选择重新开始游戏

## 功能需求

### 功能1：游戏初始化

**描述：** 创建游戏窗口，初始化游戏状态

**输入：** 游戏启动命令

**处理：** 
- 创建游戏窗口（建议使用pygame，大小如600x600像素）
- 初始化蛇的位置（屏幕中央，长度3节）
- 在随机位置生成第一个食物
- 初始化分数为0
- 设置初始移动方向

**输出：** 显示游戏窗口和初始游戏状态

**边界条件：**
- 游戏窗口大小要适中，易于游玩
- 初始蛇的长度和位置要合理

### 功能2：蛇的移动控制

**描述：** 响应键盘输入，控制蛇的移动方向

**输入：** 方向键输入（上、下、左、右）

**处理：**
- 检测键盘输入
- 更新蛇的移动方向（需要防止掉头）
- 根据当前方向移动蛇头
- 更新蛇身体的各节位置
- 如果没有吃到食物，移除蛇尾

**输出：** 蛇在新位置的显示

**边界条件：**
- 不能向相反方向移动
- 移动速度要适中（建议每秒10-15格）

### 功能3：食物生成和碰撞检测

**描述：** 生成食物并检测蛇是否吃到食物

**输入：** 蛇头的位置，食物的位置

**处理：**
- 在游戏区域内随机生成食物位置（不能与蛇身体重叠）
- 检测蛇头位置是否与食物位置重合
- 如果重合，增加分数，蛇身体增长，生成新食物

**输出：** 食物显示在游戏窗口，碰撞时更新分数和蛇长度

**边界条件：**
- 食物不能生成在蛇身体上
- 食物位置要在游戏区域内

### 功能4：碰撞检测和游戏结束

**描述：** 检测游戏结束条件

**输入：** 蛇头的位置，蛇身体的位置，游戏区域边界

**处理：**
- 检测蛇头是否超出游戏区域边界
- 检测蛇头是否碰到自己的身体
- 如果发生碰撞，触发游戏结束

**输出：** 游戏结束画面，显示最终分数

**边界条件：**
- 要检测所有可能的碰撞情况
- 游戏结束后应能够重新开始

### 功能5：游戏渲染

**描述：** 绘制游戏画面

**输入：** 游戏状态（蛇的位置、食物位置、分数）

**处理：**
- 清空画面
- 绘制蛇（使用色块，如绿色）
- 绘制食物（使用色块，如红色）
- 绘制分数文本
- 刷新显示

**输出：** 更新后的游戏画面

**边界条件：**
- 色块要足够清晰可见
- 更新频率要保持流畅

## 非功能需求

### 性能要求

- 游戏帧率应保持在30-60 FPS，确保流畅的游戏体验
- 游戏启动时间应在2秒内
- 内存占用应保持在100MB以内

### 安全要求

- 不涉及网络通信，无需特殊安全措施
- 代码应遵循Python安全最佳实践

### 可用性要求

- 游戏界面简洁明了，易于理解
- 控制方式直观（方向键）
- 游戏规则符合传统贪吃蛇玩法

### 兼容性要求

- 支持Python 3.10+
- 支持主流操作系统（Windows、macOS、Linux）
- 使用跨平台的游戏库（如pygame）

## 技术方案（概要）

### 架构设计

游戏采用简单的单文件结构或简单的模块化设计：

```
game/
├── snake/
│   ├── __init__.py
│   ├── snake.py          # 主游戏文件
│   ├── pyproject.toml    # uv项目配置
│   └── README.md         # 游戏说明
```

游戏主循环：
1. 初始化 → 事件处理 → 游戏逻辑更新 → 渲染 → 循环

### 关键技术选型

- **Python**: 使用Python 3.10+作为开发语言
- **pygame**: 用于游戏窗口、图形绘制和事件处理
- **uv**: 用于Python项目和依赖管理

选型理由：
- pygame是成熟稳定的游戏开发库，简单易用
- uv提供快速的依赖解析和安装
- Python 3.10+提供良好的语言特性支持

### 数据模型

```python
# 游戏状态
class GameState:
    snake_positions: List[Tuple[int, int]]  # 蛇的身体位置列表
    direction: Tuple[int, int]               # 当前移动方向
    food_position: Tuple[int, int]           # 食物位置
    score: int                                # 当前分数
    game_over: bool                          # 游戏是否结束

# 游戏配置
SCREEN_WIDTH = 600
SCREEN_HEIGHT = 600
GRID_SIZE = 20
SPEED = 10  # 移动速度（帧/秒）
```

### 接口设计

主要函数接口：

```python
def init_game() -> GameState:
    """初始化游戏状态"""
    
def handle_input(event) -> None:
    """处理键盘输入"""
    
def update_game(state: GameState) -> GameState:
    """更新游戏逻辑"""
    
def render(state: GameState) -> None:
    """渲染游戏画面"""
    
def check_collision(state: GameState) -> bool:
    """检测碰撞"""
    
def generate_food(state: GameState) -> Tuple[int, int]:
    """生成食物位置"""
```

## 验收标准

### 功能验收

- [ ] 游戏可以正常启动，显示游戏窗口
- [ ] 蛇可以使用方向键控制移动（上下左右）
- [ ] 蛇不能向相反方向直接掉头
- [ ] 蛇吃到食物后身体增长一节，分数增加
- [ ] 食物被吃掉后在新的随机位置生成
- [ ] 蛇头撞到边界时游戏结束
- [ ] 蛇头撞到自己身体时游戏结束
- [ ] 游戏结束时显示最终分数
- [ ] 游戏可以重新开始
- [ ] 使用uv可以正确安装依赖和运行游戏

### 性能验收

- [ ] 游戏运行流畅，无明显卡顿
- [ ] 游戏启动时间在2秒内
- [ ] 内存占用正常（< 100MB）

### 安全验收

- [ ] 代码无明显的安全漏洞
- [ ] 依赖包来自可信源

## 约束与限制

### 技术约束

- 必须使用uv作为Python包管理工具
- 必须使用Python 3.10+
- 使用pygame或其他跨平台游戏库
- 不使用图片、音效等外部资源文件

### 时间约束

- 本需求应在一个开发周期内完成（建议1-2天）

### 资源约束

- 单人开发
- 代码行数控制在500行以内，保持简洁

## 风险与回滚

### 潜在风险

| 风险 | 影响程度 | 发生概率 | 缓解措施 |
|------|---------|---------|---------|
| pygame在某些平台安装失败 | 中 | 低 | 提供详细的安装说明，考虑使用其他跨平台库如turtle |
| uv工具不稳定 | 中 | 低 | 确保使用稳定版本的uv，提供传统pip安装的备选方案 |
| 游戏性能不佳 | 低 | 低 | 优化游戏循环，减少不必要的计算 |
| 代码复杂度超出预期 | 低 | 中 | 严格控制功能范围，保持实现简单 |

### 回滚方案

本需求为新增功能，不影响现有系统，回滚相对简单：

**回滚步骤：**
1. 删除game目录及其所有内容
2. 如有必要，恢复.gitignore的相关修改
3. 提交回滚变更

**回滚验证：**
- [ ] 项目根目录不存在game目录
- [ ] 项目其他功能正常运行
- [ ] 无残留的配置或依赖

## 非目标

明确不在本需求范围内的内容：

- ❌ 不实现高级AI对手
- ❌ 不实现网络多人对战功能
- ❌ 不实现游戏排行榜系统
- ❌ 不实现游戏存档和读档功能
- ❌ 不实现多种游戏模式（只实现经典模式）
- ❌ 不实现复杂的图形界面和菜单系统
- ❌ 不实现移动端适配
- ❌ 不实现游戏录像或回放功能
- ❌ 不添加音效和背景音乐
- ❌ 不实现游戏关卡系统

## 依赖关系

### 依赖的其他需求/系统

- Python 3.10+运行环境
- uv包管理工具
- pygame库

### 被依赖的需求/系统

- 暂无其他需求依赖本游戏模块

## 参考资料

- [pygame官方文档](https://www.pygame.org/docs/)
- [uv官方文档](https://github.com/astral-sh/uv)
- [Python官方文档](https://docs.python.org/3/)
- [贪吃蛇游戏规则](https://en.wikipedia.org/wiki/Snake_(video_game_genre))
- 相关Issue: #30

---

**审批记录**

| 审批人 | 角色 | 审批时间 | 审批意见 |
|-------|------|---------|---------|
| | | | |
