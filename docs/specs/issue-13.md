# 需求规格说明书

> **Issue**: #13
> **创建时间**: 2026-02-06
> **状态**: 待审批

## 背景与目标

### 业务背景

当前项目缺少实践性的Python游戏开发示例,新开发者难以通过实际项目来学习Python游戏开发技术。同时,项目尚未使用uv这样的现代Python包管理工具。

**存在的问题:**
- 缺乏Python游戏开发的实践案例
- 没有展示如何使用uv管理Python项目
- 项目缺少有趣的交互式应用

**业务价值:**
- 提供简单易懂的游戏开发示例,适合学习和参考
- 展示现代Python项目管理工具(uv)的使用方法
- 为未来添加更多游戏或交互式应用奠定基础
- 增加项目的趣味性和实用性

### 目标

通过实现一个简单的贪吃蛇游戏,帮助开发者熟悉Python游戏开发的基本流程和技术,同时掌握使用uv工具管理Python项目的方法。

**主要目标:**
- 创建规范的Python游戏项目结构(game目录)
- 实现一个功能完整但代码简洁的贪吃蛇游戏(≤300行代码)
- 掌握uv工具的基本使用方法(项目初始化、依赖管理)
- 提供清晰的文档说明,便于学习和使用

**成功指标:**
- 游戏能够正常运行,无明显bug
- 代码简洁易读,总行数 ≤ 300行
- 使用uv可以一键安装依赖和运行游戏
- README文档完整,新用户可以在5分钟内运行起来

## 范围(包含/不包含)

### 包含在本需求中

- ✅ 创建game目录结构
- ✅ 使用uv初始化Python项目(pyproject.toml配置)
- ✅ 实现基本的贪吃蛇游戏逻辑
  - 蛇的移动控制(方向键:↑↓←→)
  - 食物随机生成和吃食物逻辑
  - 碰撞检测(墙壁和蛇身)
  - 分数统计和显示
- ✅ 简单的图形界面(使用pygame库)
- ✅ 游戏开始和结束逻辑
- ✅ README文档(包含安装、运行说明)

### 不包含在本需求中

- ❌ 复杂的图形效果和动画(保持简单)
- ❌ 多人游戏模式
- ❌ 关卡系统或难度递增机制
- ❌ 音效和背景音乐
- ❌ 排行榜和数据持久化
- ❌ 网络功能
- ❌ 高级AI对手
- ❌ 暂停/继续功能(保持最简单)
- ❌ 游戏设置菜单

## 用户故事/使用场景

### 用户故事1:快速运行游戏

**作为** Python学习者  
**我想要** 能够快速克隆项目并运行贪吃蛇游戏  
**以便** 体验游戏并学习代码实现

**验收标准:**
- [ ] README文档包含清晰的前置条件说明(Python 3.9+、uv安装)
- [ ] 安装依赖命令简单:`cd game && uv sync`
- [ ] 运行游戏命令简单:`uv run python snake.py`
- [ ] 游戏能够在主流操作系统(Windows/macOS/Linux)上正常启动
- [ ] 从克隆到运行,整个过程不超过5分钟

### 用户故事2:游玩贪吃蛇

**作为** 游戏玩家  
**我想要** 使用键盘方向键控制蛇的移动  
**以便** 吃到食物并获得高分

**验收标准:**
- [ ] 可以使用方向键(↑↓←→)控制蛇的方向
- [ ] 蛇不能直接反向移动(如向右时不能直接向左)
- [ ] 蛇吃到食物后身体立即变长1个单位
- [ ] 屏幕上实时显示当前分数
- [ ] 撞墙或撞到自己的身体时游戏结束
- [ ] 游戏结束后显示最终分数和"Game Over"提示

### 用户故事3:学习代码

**作为** 开发者  
**我想要** 查看简洁易懂的游戏代码  
**以便** 学习游戏开发的基本原理

**验收标准:**
- [ ] 代码结构清晰,使用有意义的函数和变量名
- [ ] 关键部分有适当的注释说明
- [ ] 代码行数控制在300行以内
- [ ] 核心逻辑(移动、碰撞检测、食物生成)易于理解和修改
- [ ] 使用标准的Python编码规范

### 用户故事4:学习uv工具

**作为** Python开发者  
**我想要** 了解如何使用uv管理Python项目  
**以便** 在自己的项目中使用这个现代工具

**验收标准:**
- [ ] pyproject.toml配置文件结构清晰
- [ ] README中包含uv的基本使用说明
- [ ] 依赖声明简单明了
- [ ] 可以作为uv使用的示例参考

## 功能需求

### 功能1:项目初始化和配置

**描述:** 使用uv创建Python项目,配置依赖和项目结构

**输入:** 无

**处理:** 
1. 在项目根目录创建game目录
2. 使用uv初始化项目(生成pyproject.toml)
3. 配置项目基本信息(名称、版本、Python版本要求)
4. 添加pygame作为项目依赖
5. 创建README.md说明文档

**输出:** 
```
game/
├── pyproject.toml          # uv项目配置文件
├── README.md               # 游戏说明文档
└── snake.py                # 主游戏文件
```

**边界条件:**
- Python版本要求:≥3.9(3.8已于2024年10月EOL)
- pygame版本:使用最新稳定版(通过uv自动管理)
- 需要用户预先安装uv工具

**技术细节:**
- pyproject.toml应包含:
  - project.name = "snake-game"
  - project.requires-python = ">=3.9"
  - project.dependencies = ["pygame>=2.5.0"]

### 功能2:游戏窗口和初始化

**描述:** 创建游戏窗口并初始化游戏状态

**输入:** 
- 窗口大小:600x600像素
- 网格大小:20x20像素(每个格子)
- 初始帧率:10 FPS

**处理:**
1. 初始化pygame模块
2. 创建游戏窗口(600x600像素)
3. 设置窗口标题"贪吃蛇游戏 - Snake Game"
4. 创建游戏时钟控制帧率
5. 初始化蛇的初始位置(窗口中心,长度3个单位)
6. 初始化蛇的移动方向(向右)
7. 在随机位置生成第一个食物
8. 初始化分数为0

**输出:** 
- 显示600x600像素的游戏窗口
- 显示初始游戏状态(蛇和食物)

**边界条件:**
- 窗口不可调整大小
- 网格数量:30x30(600/20)
- 蛇初始长度:3个单位
- 蛇初始位置:(15, 15) - 窗口中心

**技术细节:**
- 使用pygame.display.set_mode()创建窗口
- 使用pygame.time.Clock()控制帧率
- 蛇身使用列表存储坐标:[(x1,y1), (x2,y2), (x3,y3)]
- 坐标系统:网格坐标,而非像素坐标

### 功能3:蛇的移动控制

**描述:** 响应键盘输入,控制蛇的移动方向和位置更新

**输入:** 
- 方向键输入:↑(UP)、↓(DOWN)、←(LEFT)、→(RIGHT)
- 或WASD键:W(上)、S(下)、A(左)、D(右)

**处理:**
1. 监听pygame键盘事件
2. 根据按键更新蛇的移动方向
3. 验证方向改变的有效性(不能反向移动)
4. 每帧根据当前方向移动蛇头
5. 如果没有吃到食物,移除蛇尾(保持长度不变)
6. 如果吃到食物,不移除蛇尾(身体变长)

**输出:** 
- 蛇在屏幕上按照控制方向移动
- 移动平滑且响应及时

**边界条件:**
- 不能直接反向移动:
  - 向上移动时,不能直接向下
  - 向右移动时,不能直接向左
  - 以此类推
- 移动速度固定:10格/秒(FPS=10)
- 连续按键时只响应第一个有效按键

**技术细节:**
- 使用pygame.KEYDOWN事件检测按键
- 方向存储为(dx, dy):
  - 上:(0, -1)
  - 下:(0, 1)
  - 左:(-1, 0)
  - 右:(1, 0)
- 反向检测:new_dir != (-current_dir[0], -current_dir[1])

### 功能4:食物系统

**描述:** 在随机位置生成食物,检测蛇吃到食物的事件

**输入:** 
- 蛇的当前位置列表
- 网格范围(30x30)

**处理:**
1. 在网格中随机选择一个位置
2. 验证该位置不在蛇身上
3. 如果在蛇身上,重新生成位置
4. 每帧检测蛇头位置是否与食物位置重合
5. 如果重合:
   - 标记吃到食物
   - 分数+1
   - 生成新食物
   - 蛇身在下一次移动时变长

**输出:** 
- 食物显示在屏幕上(红色方块)
- 蛇吃到食物后立即在新位置生成新食物
- 分数实时更新

**边界条件:**
- 食物位置范围:(0, 0)到(29, 29)
- 食物不能生成在蛇身上
- 每次只有一个食物存在
- 最多尝试100次找到有效位置(防止无限循环)

**技术细节:**
- 使用random.randint()生成随机坐标
- 碰撞检测:head_pos == food_pos
- 食物颜色:RGB(255, 0, 0) 红色

### 功能5:碰撞检测和游戏结束

**描述:** 检测游戏结束条件(撞墙或撞到自己)

**输入:** 
- 蛇头位置
- 蛇身位置列表
- 网格边界(30x30)

**处理:**
1. 检测墙壁碰撞:
   - 蛇头x坐标 < 0 或 >= 30
   - 蛇头y坐标 < 0 或 >= 30
2. 检测自身碰撞:
   - 蛇头位置是否在蛇身列表中(排除蛇头本身)
3. 如果发生任何碰撞:
   - 设置游戏结束标志
   - 显示"Game Over"消息
   - 显示最终分数
   - 停止游戏循环

**输出:** 
- 游戏结束时显示:
  - "Game Over" 文字
  - "Score: X" 最终分数
  - 游戏窗口保持打开,直到用户关闭

**边界条件:**
- 边界范围:x和y都在[0, 29]之间
- 蛇身长度≥4时才可能撞到自己(头+3个身体)
- 游戏结束后不再响应方向键

**技术细节:**
- 墙壁碰撞检测:head[0] < 0 or head[0] >= 30 or head[1] < 0 or head[1] >= 30
- 自身碰撞检测:head in snake_body[1:]
- 使用pygame.font渲染文字

### 功能6:游戏循环和渲染

**描述:** 主游戏循环,负责更新游戏状态和渲染画面

**输入:** 
- 游戏状态(蛇、食物、分数、游戏结束标志)
- 帧率:10 FPS

**处理:**
1. 事件处理:
   - 处理退出事件(关闭窗口)
   - 处理键盘输入(方向控制)
2. 游戏逻辑更新(如果游戏未结束):
   - 移动蛇
   - 检测食物碰撞
   - 检测游戏结束碰撞
3. 画面渲染:
   - 清空屏幕(黑色背景)
   - 绘制食物(红色方块)
   - 绘制蛇(绿色方块)
   - 显示分数(白色文字)
   - 如果游戏结束,显示Game Over
   - 刷新显示
4. 帧率控制:clock.tick(10)

**输出:** 
- 持续更新的游戏画面
- 流畅的游戏体验

**边界条件:**
- 帧率稳定在10 FPS
- 游戏循环在用户关闭窗口时退出
- 游戏结束后仍然渲染画面

**技术细节:**
- 背景色:RGB(0, 0, 0) 黑色
- 蛇颜色:RGB(0, 255, 0) 绿色
- 食物颜色:RGB(255, 0, 0) 红色
- 文字颜色:RGB(255, 255, 255) 白色
- 使用pygame.draw.rect()绘制方块
- 每个方块大小:20x20像素

## 非功能需求

### 性能要求

- **帧率稳定性**: 游戏运行稳定在10 FPS,无明显卡顿
- **响应延迟**: 键盘输入响应延迟 < 50ms
- **内存占用**: 游戏运行时内存占用 < 50MB
- **CPU占用**: 单核CPU占用 < 3%
- **启动时间**: 从运行命令到显示游戏窗口 < 2秒

### 安全要求

- **数据安全**: 不涉及网络通信,无数据泄露风险
- **隐私保护**: 不收集任何用户数据
- **文件访问**: 不访问文件系统(除游戏本身代码)
- **依赖安全**: 使用官方稳定版pygame,无已知安全漏洞

### 可用性要求

- **代码可读性**: 
  - 代码简洁,总行数 ≤ 300行
  - 函数和变量命名清晰有意义
  - 关键部分有注释说明
- **文档完整性**:
  - README包含安装、运行、玩法说明
  - 说明如何安装uv工具
  - 提供常见问题解答
- **用户体验**:
  - 游戏操作简单直观,无需说明即可上手
  - 游戏界面简洁清晰
  - 错误提示友好(如依赖未安装时给出明确提示)

### 兼容性要求

- **Python版本**: 支持Python 3.9+(3.8已于2024年10月EOL)
- **操作系统**: 
  - Windows 10/11
  - macOS 12+
  - Linux(主流发行版)
- **包管理器**: 使用uv工具管理依赖
- **图形库**: 使用跨平台的pygame库(>=2.5.0)

## 技术方案(概要)

### 架构设计

**单文件架构**:采用简单的单文件设计,便于学习和理解

```
game/
├── pyproject.toml          # uv项目配置
├── README.md               # 说明文档
└── snake.py                # 主游戏文件(200-300行)
```

**代码结构**(函数式设计):

```python
# 常量定义
WINDOW_SIZE = 600
GRID_SIZE = 20
...

# 初始化函数
def init_game():
    """初始化游戏状态"""
    pass

# 游戏逻辑函数
def handle_input(event, direction):
    """处理键盘输入"""
    pass

def move_snake(snake, direction):
    """移动蛇"""
    pass

def check_food_collision(snake_head, food):
    """检测食物碰撞"""
    pass

def check_game_over(snake_head, snake_body):
    """检测游戏结束"""
    pass

def generate_food(snake):
    """生成食物"""
    pass

# 渲染函数
def draw_game(screen, snake, food, score):
    """渲染游戏画面"""
    pass

def draw_game_over(screen, score):
    """渲染游戏结束画面"""
    pass

# 主循环
def game_loop():
    """主游戏循环"""
    pass

# 入口函数
def main():
    """程序入口"""
    pygame.init()
    game_loop()
    pygame.quit()

if __name__ == "__main__":
    main()
```

### 关键技术选型

**Python 3.9+**
- 理由:稳定且有良好支持(3.8已EOL)
- 优势:语法现代、性能良好、社区活跃

**uv (Python包管理器)**
- 理由:现代、快速的Python包管理工具
- 优势:比pip快10-100倍,使用简单,配置清晰
- 使用方式:
  ```bash
  uv init              # 初始化项目
  uv add pygame        # 添加依赖
  uv sync              # 安装依赖
  uv run python snake.py  # 运行程序
  ```

**pygame (游戏开发库)**
- 理由:Python游戏开发的标准库
- 优势:
  - 成熟稳定,文档丰富
  - 跨平台支持好
  - 学习资源多
  - API简单易用
- 版本要求:>=2.5.0

### 数据模型

**蛇(Snake)**:
```python
# 使用列表存储蛇身坐标
snake = [(15, 15), (14, 15), (13, 15)]  # 头部在索引0
direction = (1, 0)  # (dx, dy) 移动方向
```

**食物(Food)**:
```python
food = (20, 10)  # (x, y) 坐标
```

**游戏状态(Game State)**:
```python
game_state = {
    'snake': [(15, 15), (14, 15), (13, 15)],
    'direction': (1, 0),
    'food': (20, 10),
    'score': 0,
    'game_over': False
}
```

### 核心算法

**1. 蛇的移动算法**:
```python
def move_snake(snake, direction, grow=False):
    # 计算新的头部位置
    new_head = (snake[0][0] + direction[0], 
                snake[0][1] + direction[1])
    
    # 在头部插入新位置
    snake.insert(0, new_head)
    
    # 如果没有吃到食物,移除尾部
    if not grow:
        snake.pop()
    
    return snake
```

**2. 碰撞检测算法**:
```python
def check_collision(head, snake_body, grid_size=30):
    # 检测墙壁碰撞
    if head[0] < 0 or head[0] >= grid_size:
        return True
    if head[1] < 0 or head[1] >= grid_size:
        return True
    
    # 检测自身碰撞
    if head in snake_body[1:]:
        return True
    
    return False
```

**3. 食物生成算法**:
```python
def generate_food(snake, grid_size=30):
    max_attempts = 100
    for _ in range(max_attempts):
        food = (random.randint(0, grid_size-1),
                random.randint(0, grid_size-1))
        if food not in snake:
            return food
    # 如果尝试失败,返回任意位置
    return (random.randint(0, grid_size-1),
            random.randint(0, grid_size-1))
```

## 验收标准

### 功能验收

- [ ] **项目结构**: game目录包含pyproject.toml、README.md和snake.py
- [ ] **依赖安装**: 执行`cd game && uv sync`成功安装依赖
- [ ] **游戏启动**: 执行`uv run python snake.py`成功启动游戏窗口
- [ ] **方向控制**: 方向键(↑↓←→)可以正常控制蛇的移动
- [ ] **反向限制**: 蛇不能直接反向移动(如向右时不能直接向左)
- [ ] **食物机制**: 蛇吃到食物后身体变长,分数+1,新食物在随机位置生成
- [ ] **碰撞检测**: 撞墙或撞到自己时游戏结束,显示Game Over和最终分数
- [ ] **分数显示**: 游戏过程中实时显示当前分数
- [ ] **跨平台**: 在Windows、macOS、Linux上都能正常运行

### 性能验收

- [ ] 游戏运行流畅,帧率稳定,无明显卡顿
- [ ] 键盘响应及时,无延迟感(<50ms)
- [ ] 内存占用 < 50MB
- [ ] CPU占用 < 3%(空闲时)

### 代码质量验收

- [ ] 代码总行数 ≤ 300行
- [ ] 代码结构清晰,函数职责单一
- [ ] 变量和函数命名有意义,易于理解
- [ ] 关键部分有适当的注释
- [ ] 符合Python PEP 8编码规范(基本要求)

### 文档验收

- [ ] README包含完整的安装说明(如何安装uv)
- [ ] README包含运行说明(具体命令)
- [ ] README包含游戏玩法说明
- [ ] README包含常见问题解答(如pygame安装问题)
- [ ] pyproject.toml配置正确,依赖声明清晰

## 约束与限制

### 技术约束

- **必须使用uv**: 项目必须使用uv作为Python包管理工具
- **代码简洁性**: 游戏实现应尽量简单,总代码行数 ≤ 300行
- **单文件实现**: 主游戏逻辑实现在单个snake.py文件中
- **图形库限制**: 使用pygame或类似的轻量级2D游戏库
- **Python版本**: 要求Python 3.9+(不支持3.8及以下版本)
- **无外部服务**: 不依赖网络服务或外部API

### 时间约束

- **开发时间**: 预计1-2天内完成基本实现
- **文档编写**: 预计0.5-1小时完成README文档

### 资源约束

- **开发人员**: 单人开发即可完成
- **开发工具**: 只需要Python、uv和文本编辑器
- **测试设备**: 至少在一个平台上测试(Windows/macOS/Linux任一)
- **成本**: 零成本,所有工具和库都是开源免费的

## 风险与回滚

### 潜在风险

| 风险 | 影响程度 | 发生概率 | 缓解措施 |
|------|---------|---------|---------|
| uv工具使用不熟悉导致配置错误 | 中 | 中 | 参考uv官方文档,使用最简单的配置;在README中提供详细的uv使用说明 |
| pygame在某些系统上安装失败 | 中 | 低 | 在README中提供详细的pygame安装说明和常见问题解决方案;使用uv可以更好地管理依赖 |
| 游戏逻辑bug(碰撞检测不准确) | 低 | 中 | 使用网格坐标系统简化逻辑;充分测试边界情况;保持代码简单清晰 |
| 代码过于复杂不利于学习 | 中 | 低 | 严格控制代码行数(≤300行);使用简单的函数式设计;添加适当注释 |
| 跨平台兼容性问题 | 低 | 低 | pygame本身跨平台性好;避免使用特定平台的API;在多个平台上测试 |
| 性能问题(游戏卡顿) | 低 | 低 | 使用简单的渲染方式;控制帧率在10 FPS;避免复杂的图形效果 |

### 回滚方案

由于这是一个新增功能(创建新的game目录和文件),回滚非常简单:

**回滚步骤:**
1. 删除整个game目录:`rm -rf game/`
2. 提交删除变更:`git add . && git commit -m "Rollback: Remove snake game"`
3. 推送变更:`git push`

**回滚验证:**
- [ ] game目录已从项目中移除
- [ ] 项目其他部分不受影响
- [ ] git历史记录正常

**注意事项:**
- 这是一个独立的新功能,不会影响现有代码
- 回滚不会造成任何副作用
- 可以随时重新实现

## 非目标

明确说明本需求不打算解决的问题,避免范围蔓延:

- ❌ **不是游戏引擎教程**: 不会深入讲解pygame的所有功能
- ❌ **不是完整游戏**: 不会实现复杂的游戏系统(如关卡、道具、技能等)
- ❌ **不是性能优化案例**: 不会进行深度性能优化(够用即可)
- ❌ **不是UI/UX设计展示**: 界面保持简单,不追求视觉效果
- ❌ **不是多人游戏平台**: 不实现网络功能和多人对战
- ❌ **不是AI演示**: 不实现AI自动游玩功能
- ❌ **不是数据分析项目**: 不实现游戏数据统计和分析
- ❌ **不解决Python环境管理**: 假设用户已有Python环境(只展示uv的使用)

## 依赖关系

### 依赖的其他需求/系统

- **Python环境**: 需要用户系统已安装Python 3.9+
- **uv工具**: 需要用户已安装uv包管理工具
- **操作系统**: 需要支持pygame的操作系统(Windows/macOS/Linux)
- **显示设备**: 需要图形界面环境(不支持纯命令行环境)

### 被依赖的需求/系统

- **未来游戏扩展**: 本项目为game目录奠定基础,未来可以添加更多游戏
- **学习示例**: 可以作为Python游戏开发的入门示例
- **uv使用示例**: 可以作为uv工具使用的参考案例

## 参考资料

### 官方文档

- [uv官方文档](https://github.com/astral-sh/uv) - uv包管理工具使用指南
- [pygame官方文档](https://www.pygame.org/docs/) - pygame库API参考
- [Python官方文档](https://docs.python.org/3/) - Python语言参考

### 教程资料

- [Pygame贪吃蛇教程](https://www.pygame.org/wiki/tutorials) - pygame官方教程
- [Snake Game Algorithm](https://en.wikipedia.org/wiki/Snake_(video_game_genre)) - 贪吃蛇游戏算法说明

### 相关Issue/PR

- **当前Issue**: #13 - 贪吃蛇游戏
- **需求文档**: docs/requirements/issue-13.md - 已审批通过

### 示例代码参考

```python
# 最小可行示例(伪代码)
import pygame
import random

WINDOW_SIZE = 600
GRID_SIZE = 20

def main():
    pygame.init()
    screen = pygame.display.set_mode((WINDOW_SIZE, WINDOW_SIZE))
    clock = pygame.time.Clock()
    
    snake = [(15, 15), (14, 15), (13, 15)]
    direction = (1, 0)
    food = (20, 10)
    score = 0
    game_over = False
    
    while True:
        # 事件处理
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                return
            if event.type == pygame.KEYDOWN:
                # 处理方向键...
                pass
        
        if not game_over:
            # 移动蛇
            # 检测碰撞
            # 更新分数
            pass
        
        # 渲染
        screen.fill((0, 0, 0))
        # 绘制食物和蛇...
        pygame.display.flip()
        clock.tick(10)

if __name__ == "__main__":
    main()
```

---

## 审批说明

**本规格说明书基于已审批的需求文档(docs/requirements/issue-13.md)编写,提供了更详细的技术规格和实现细节。**

**请审查以下内容:**

1. ✅ 技术方案是否可行且合理
2. ✅ 功能需求描述是否清晰明确
3. ✅ 验收标准是否具体可测
4. ✅ 非功能需求是否完整
5. ✅ 风险评估和缓解措施是否充分
6. ✅ 技术选型(uv + pygame)是否合适
7. ✅ 代码结构设计是否简洁易懂

**审批操作:**

- **通过**: 合并此PR,系统将自动生成执行计划(Plan)
- **修改**: 在PR中提出修改意见,Copilot会根据反馈调整
- **拒绝**: 关闭PR并在原Issue中说明原因

---

**注意**: 本文档由Copilot根据需求文档自动生成,提供了详细的技术规格说明。审批通过后将进入Plan(执行计划)阶段,然后开始具体实现。
