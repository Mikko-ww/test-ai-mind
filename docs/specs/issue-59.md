# 需求规格说明书

> **Issue**: #59
> **创建时间**: 2026-02-12
> **状态**: 草稿

## 背景与目标

### 业务背景

在项目根目录下需要创建一个专门用于存放Python小游戏的目录结构。当前项目缺少实践性的Python代码示例，通过添加一个简单的贪吃蛇游戏，可以：
- 为项目提供一个完整的Python应用示例
- 展示如何使用uv进行Python项目依赖管理
- 提供一个可运行的娱乐性应用
- 为后续添加更多Python小游戏奠定基础

### 目标

本需求旨在创建一个简单但完整的Python贪吃蛇游戏项目，使用现代Python工具链进行管理。

**主要目标：**
- 在根目录下创建game目录用于存放Python小游戏
- 实现一个可运行的贪吃蛇游戏
- 使用uv作为Python包管理工具
- 保持游戏逻辑简单，易于理解和维护

**成功指标：**
- 游戏可以成功运行，无报错
- 使用uv可以正确管理项目依赖
- 游戏包含基本的贪吃蛇玩法逻辑

## 范围（包含/不包含）

### 包含在本需求中

- ✅ 创建game目录结构
- ✅ 使用uv初始化Python项目（pyproject.toml配置）
- ✅ 实现贪吃蛇游戏的核心逻辑
  - 蛇的移动
  - 食物的生成
  - 碰撞检测（边界、自身）
  - 得分统计
- ✅ 简单的用户界面（命令行或基础图形界面）
- ✅ 基本的键盘控制
- ✅ 游戏结束判断和提示
- ✅ README文档说明如何运行

### 不包含在本需求中

- ❌ 复杂的游戏特效和动画
- ❌ 高级功能（暂停、存档、排行榜等）
- ❌ 多人游戏模式
- ❌ 音效和背景音乐
- ❌ 关卡系统和难度选择
- ❌ 高级图形界面设计
- ❌ 移动端适配
- ❌ 网络联机功能

## 用户故事/使用场景

### 用户故事1：运行游戏

**作为** 项目使用者  
**我想要** 能够快速安装依赖并运行贪吃蛇游戏  
**以便** 体验游戏并了解项目结构

**验收标准：**
- [ ] 执行uv sync安装依赖成功
- [ ] 运行游戏命令后游戏正常启动
- [ ] 可以看到游戏界面和初始游戏状态

### 用户故事2：游戏交互

**作为** 玩家  
**我想要** 使用键盘控制蛇的移动方向  
**以便** 吃到食物并获得分数

**验收标准：**
- [ ] 可以使用方向键或WASD控制蛇的移动
- [ ] 蛇能够正确响应方向变化
- [ ] 吃到食物后蛇变长且分数增加
- [ ] 撞到边界或自身时游戏结束

### 用户故事3：查看游戏结果

**作为** 玩家  
**我想要** 在游戏结束时看到最终得分  
**以便** 了解本局游戏的表现

**验收标准：**
- [ ] 游戏结束时显示Game Over提示
- [ ] 显示本局获得的分数
- [ ] 提供退出或重新开始的选项

## 功能需求

### 功能1：游戏初始化

**描述：** 游戏启动时初始化游戏状态，包括游戏区域、蛇的初始位置和食物位置

**输入：** 游戏启动命令

**处理：**
- 创建游戏窗口或显示区域
- 初始化蛇的位置（居中，长度为3-5节）
- 随机生成第一个食物位置
- 初始化分数为0

**输出：** 显示初始游戏界面

**边界条件：**
- 确保食物不会生成在蛇身上
- 游戏区域大小合理（如20x20或30x30）

### 功能2：蛇的移动

**描述：** 蛇按照当前方向持续移动

**输入：** 游戏时钟tick

**处理：**
- 根据当前方向计算蛇头的新位置
- 将新位置添加到蛇身列表头部
- 如果没吃到食物，移除蛇尾
- 如果吃到食物，保留蛇尾（蛇变长）

**输出：** 更新蛇的位置并刷新显示

**边界条件：**
- 蛇不能向相反方向移动（如向右时不能直接向左）
- 移动速度应该适中（约100-200ms每步）

### 功能3：方向控制

**描述：** 玩家通过键盘控制蛇的移动方向

**输入：** 键盘按键（方向键或WASD）

**处理：**
- 检测键盘输入
- 验证方向变化是否合法（不能180度转向）
- 更新蛇的移动方向

**输出：** 蛇按新方向移动

**边界条件：**
- 防止快速连续按键导致的非法转向
- 忽略其他无关按键

### 功能4：碰撞检测

**描述：** 检测蛇是否撞到边界或自身

**输入：** 蛇的当前位置

**处理：**
- 检查蛇头是否超出游戏区域边界
- 检查蛇头是否与蛇身任一节重合

**输出：** 碰撞标志（是/否）

**边界条件：**
- 蛇头与蛇身第一节（脖子）不算碰撞
- 边界检测需要考虑索引范围

### 功能5：食物生成

**描述：** 当蛇吃到食物后，在空白位置随机生成新食物

**输入：** 蛇吃到食物事件

**处理：**
- 在游戏区域内随机选择坐标
- 检查该位置是否被蛇占据
- 如果被占据则重新选择

**输出：** 新食物的坐标

**边界条件：**
- 确保食物位置不在蛇身上
- 如果游戏区域几乎被填满，需要有合理的查找逻辑

### 功能6：得分系统

**描述：** 记录并显示玩家得分

**输入：** 蛇吃到食物事件

**处理：**
- 每吃到一个食物，分数加1（或其他固定值）
- 更新显示的分数

**输出：** 当前分数

**边界条件：**
- 分数从0开始
- 分数只增不减

### 功能7：游戏结束

**描述：** 当检测到碰撞时，游戏结束并显示结果

**输入：** 碰撞检测结果为true

**处理：**
- 停止游戏循环
- 显示Game Over消息
- 显示最终得分
- 提供退出选项

**输出：** 游戏结束界面

**边界条件：**
- 游戏结束后不再接受移动输入
- 可以选择退出或重新开始

## 非功能需求

### 性能要求

- 游戏运行流畅，帧率稳定（约10-30 FPS）
- 响应用户输入延迟 < 50ms
- 启动时间 < 2秒

### 安全要求

- 无需特殊安全要求（单机游戏）
- 不涉及用户数据存储

### 可用性要求

- 游戏界面清晰，蛇和食物易于区分
- 控制方式直观，易于上手
- 有简单的使用说明

### 兼容性要求

- 支持Python 3.10+
- 跨平台（Windows、macOS、Linux）
- 使用uv进行依赖管理

## 技术方案（概要）

### 架构设计

采用简单的单文件或少量文件结构：
```
game/
├── pyproject.toml          # uv项目配置
├── README.md               # 使用说明
├── snake_game/
│   ├── __init__.py
│   └── game.py            # 游戏主逻辑
└── .python-version         # Python版本指定
```

### 关键技术选型

- **Python**: 使用Python 3.10+作为开发语言
- **uv**: 用于Python项目依赖管理和虚拟环境管理
- **pygame**: （可选）如果需要图形界面，使用pygame库
- **curses/rich**: （可选）如果使用命令行界面，使用curses或rich库

### 数据模型

**蛇的表示：**
```python
snake: List[Tuple[int, int]]  # 坐标列表，第一个是头部
direction: Tuple[int, int]     # 移动方向向量
```

**游戏状态：**
```python
food: Tuple[int, int]         # 食物坐标
score: int                     # 当前分数
game_over: bool               # 游戏是否结束
```

### 接口设计

主要类/函数：
- `Game`: 游戏主类
  - `__init__()`: 初始化游戏
  - `run()`: 游戏主循环
  - `update()`: 更新游戏状态
  - `render()`: 渲染游戏画面
  - `handle_input()`: 处理用户输入
  - `check_collision()`: 碰撞检测
  - `generate_food()`: 生成食物

## 验收标准

### 功能验收

- [ ] game目录已创建，结构合理
- [ ] pyproject.toml配置正确，使用uv管理
- [ ] 执行`uv sync`成功安装依赖
- [ ] 执行游戏启动命令后游戏正常运行
- [ ] 蛇可以通过键盘控制移动
- [ ] 蛇吃到食物后变长，分数增加
- [ ] 食物在被吃后重新随机生成
- [ ] 撞到边界时游戏结束
- [ ] 撞到自身时游戏结束
- [ ] 游戏结束时显示最终分数
- [ ] README文档清晰说明如何运行游戏

### 性能验收

- [ ] 游戏运行流畅，无明显卡顿
- [ ] 按键响应及时
- [ ] 游戏可以持续运行5分钟以上无崩溃

### 安全验收

- [ ] 代码无明显安全漏洞
- [ ] 依赖包来源可信

## 约束与限制

### 技术约束

- 必须使用uv作为Python包管理工具
- Python版本需要3.10或以上
- 游戏逻辑应尽量简单，避免过度设计
- 代码应该易于理解和维护

### 时间约束

- 需要快速实现，不追求复杂功能
- 优先保证核心功能可用

### 资源约束

- 单人开发，工作量应该控制在合理范围内
- 不需要复杂的资源文件（图片、音效等）

## 风险与回滚

### 潜在风险

| 风险 | 影响程度 | 发生概率 | 缓解措施 |
|------|---------|---------|---------|
| pygame等图形库在某些环境下安装失败 | 中 | 中 | 提供命令行版本作为备选方案 |
| 跨平台兼容性问题 | 低 | 低 | 使用纯Python标准库或经过验证的跨平台库 |
| 游戏性能在低配置设备上不佳 | 低 | 低 | 优化游戏循环，控制帧率 |
| uv工具在某些环境下不可用 | 中 | 低 | 提供使用pip的备选安装方式说明 |

### 回滚方案

由于这是新增功能，回滚相对简单：

**回滚步骤：**
1. 删除game目录
2. 如果修改了根目录的README或其他配置，恢复修改
3. 提交回滚commit

**回滚验证：**
- [ ] game目录已被删除
- [ ] 项目其他部分功能正常
- [ ] 无残留配置文件

## 非目标

本需求明确不包含以下内容：

- ❌ 实现多个不同的游戏（仅实现贪吃蛇）
- ❌ 提供游戏编辑器或关卡编辑功能
- ❌ 实现复杂的AI对手
- ❌ 添加多人游戏模式
- ❌ 实现数据持久化（存档、排行榜）
- ❌ 提供Web版本或移动版本
- ❌ 游戏引擎的通用框架设计
- ❌ 完善的单元测试覆盖（可以有基础测试，但不强制）

## 依赖关系

### 依赖的其他需求/系统

- uv工具需要预先在开发环境中安装
- Python 3.10+运行环境

### 被依赖的需求/系统

- 本需求为独立功能，暂无其他需求依赖此功能
- 未来可能基于此game目录添加更多小游戏

## 参考资料

- [uv官方文档](https://github.com/astral-sh/uv)
- [Python官方文档](https://docs.python.org/3/)
- [Pygame文档](https://www.pygame.org/docs/) （如果使用pygame）
- [贪吃蛇游戏算法说明](https://en.wikipedia.org/wiki/Snake_(video_game_genre))
- Issue #59

---

**审批记录**

| 审批人 | 角色 | 审批时间 | 审批意见 |
|-------|------|---------|---------|
| | | | |
