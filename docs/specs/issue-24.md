# 需求规格说明书

> **Issue**: #24
> **创建时间**: 2026-02-11 03:26:39
> **状态**: 草稿

## 背景与目标

### 业务背景

本项目需要在根目录下添加一个 `game` 目录，用于存放Python小游戏集合。作为第一个示例游戏，需要实现一个经典的贪吃蛇游戏。

当前存在的问题或痛点：
- 项目缺少交互式的演示应用
- 需要一个简单直观的Python项目示例
- 缺少使用 `uv` 工具管理Python项目的实践案例

业务价值和预期收益：
- 为项目增加趣味性和可玩性
- 提供一个Python游戏开发的参考实现
- 展示如何使用 `uv` 管理Python依赖和项目
- 为后续添加更多小游戏建立基础架构

### 目标

**主要目标：**
- 在根目录创建 `game` 目录结构
- 实现一个可运行的贪吃蛇游戏
- 使用 `uv` 作为Python包管理工具
- 保持游戏实现简单，易于理解和维护

**成功指标：**
- 游戏能够正常启动和运行
- 游戏具备基本的贪吃蛇玩法（移动、吃食物、碰撞检测）
- 使用色块渲染，不依赖外部图片资源
- 项目可以通过 `uv` 命令正确管理依赖

## 范围（包含/不包含）

### 包含在本需求中

- ✅ 创建 `game` 目录结构
- ✅ 实现基础的贪吃蛇游戏逻辑
- ✅ 键盘控制（方向键或WASD）
- ✅ 食物随机生成
- ✅ 碰撞检测（墙壁、自身）
- ✅ 分数显示
- ✅ 使用色块作为游戏元素渲染
- ✅ 使用 `uv` 管理Python项目依赖
- ✅ 基本的游戏说明文档

### 不包含在本需求中

- ❌ 复杂的图形界面和精美的图片资源
- ❌ 音效和背景音乐
- ❌ 关卡系统和难度等级
- ❌ 排行榜功能
- ❌ 多人游戏模式
- ❌ 游戏暂停和保存功能
- ❌ 高级AI或自动游戏
- ❌ 移动端或Web版本

## 用户故事/使用场景

### 用户故事1：启动游戏

**作为** 游戏玩家  
**我想要** 能够快速启动贪吃蛇游戏  
**以便** 开始游玩

**验收标准：**
- [ ] 在 `game` 目录下执行启动命令后，游戏窗口正常打开
- [ ] 游戏窗口显示初始游戏状态（蛇、食物、分数）
- [ ] 启动过程没有错误提示

### 用户故事2：控制贪吃蛇移动

**作为** 游戏玩家  
**我想要** 使用键盘控制蛇的移动方向  
**以便** 引导蛇吃到食物

**验收标准：**
- [ ] 按方向键（或WASD键）能够改变蛇的移动方向
- [ ] 蛇不能直接反向移动（如向右移动时不能直接向左）
- [ ] 蛇以固定速度持续移动

### 用户故事3：吃食物和增长

**作为** 游戏玩家  
**我想要** 当蛇头碰到食物时蛇身变长  
**以便** 挑战更高的分数

**验收标准：**
- [ ] 蛇头与食物碰撞时，蛇身增加一节
- [ ] 食物被吃掉后在新的随机位置生成
- [ ] 分数增加并实时显示

### 用户故事4：游戏结束

**作为** 游戏玩家  
**我想要** 当蛇撞墙或撞到自己时游戏结束  
**以便** 知道游戏已经失败

**验收标准：**
- [ ] 蛇头碰到边界时游戏结束
- [ ] 蛇头碰到自己的身体时游戏结束
- [ ] 游戏结束时显示最终分数
- [ ] 提供重新开始或退出的选项

## 功能需求

### 功能1：游戏初始化

**描述：** 初始化游戏窗口、游戏状态和游戏元素

**输入：** 游戏启动命令

**处理：** 
- 创建游戏窗口（固定大小）
- 初始化蛇的位置（起始长度3-5节，位于屏幕中央）
- 随机生成第一个食物位置
- 初始化分数为0
- 设置初始移动方向

**输出：** 显示游戏窗口，包含初始游戏状态

**边界条件：**
- 窗口大小固定（如600x600像素）
- 游戏区域使用网格划分（如30x30格子）
- 食物不能生成在蛇身上

### 功能2：蛇的移动

**描述：** 处理蛇的连续移动和方向控制

**输入：** 
- 游戏循环tick
- 玩家键盘输入（可选）

**处理：** 
- 每个游戏tick，蛇头向当前方向移动一格
- 蛇身跟随蛇头移动（每一节移动到前一节的位置）
- 如果有新的方向输入，更新移动方向（需验证不能反向）
- 移动速度由游戏tick频率控制（如每秒10次）

**输出：** 更新蛇的位置，重新渲染游戏画面

**边界条件：**
- 方向只能是上、下、左、右四个方向
- 不允许直接反向移动
- 移动必须在网格内进行

### 功能3：食物生成

**描述：** 在游戏区域内随机生成食物

**输入：** 食物被吃掉的事件

**处理：** 
- 在游戏网格内随机选择一个位置
- 检查该位置是否被蛇占据
- 如果被占据，重新选择位置
- 生成食物并渲染

**输出：** 在新位置显示食物

**边界条件：**
- 食物必须生成在空白网格内
- 食物一次只有一个

### 功能4：碰撞检测

**描述：** 检测蛇头与食物、墙壁、自身的碰撞

**输入：** 蛇头的新位置

**处理：** 
- 检测是否与食物碰撞：增加蛇长度，更新分数，生成新食物
- 检测是否撞墙：游戏结束
- 检测是否撞到自身：游戏结束

**输出：** 
- 碰到食物：继续游戏，更新游戏状态
- 碰到墙壁或自身：触发游戏结束

**边界条件：**
- 蛇头位置超出游戏区域边界视为撞墙
- 蛇头与身体任意一节重叠视为碰撞

### 功能5：游戏渲染

**描述：** 将游戏状态渲染到屏幕

**输入：** 当前游戏状态（蛇的位置、食物位置、分数）

**处理：** 
- 清空画面
- 绘制游戏区域背景
- 绘制蛇（使用不同颜色的矩形色块表示头部和身体）
- 绘制食物（使用矩形色块）
- 显示当前分数文字

**输出：** 更新后的游戏画面

**边界条件：**
- 使用简单的色块渲染，不使用图片
- 蛇头和身体可使用不同颜色区分
- 食物使用醒目的颜色

### 功能6：游戏结束处理

**描述：** 处理游戏结束状态

**输入：** 游戏结束事件

**处理：** 
- 停止游戏循环
- 显示游戏结束信息和最终分数
- 等待玩家选择（重新开始或退出）

**输出：** 游戏结束画面

**边界条件：**
- 游戏结束后不再响应移动控制
- 提供明确的操作提示

## 非功能需求

### 性能要求

- 游戏帧率稳定在 30-60 FPS
- 键盘响应延迟 < 50ms
- 游戏启动时间 < 3秒

### 安全要求

- 无需网络连接，本地运行
- 不收集用户数据
- 代码开源，无恶意代码

### 可用性要求

- 游戏控制简单直观
- 提供基本的使用说明
- 代码结构清晰，易于理解和修改

### 兼容性要求

- 支持 Python 3.10+
- 支持 Windows、macOS、Linux 操作系统
- 使用跨平台的 Python 游戏库（如 pygame）

## 技术方案（概要）

### 架构设计

游戏采用简单的单文件或模块化设计：

```
game/
├── snake/
│   ├── pyproject.toml      # uv 项目配置
│   ├── uv.lock             # 依赖锁定文件
│   ├── README.md           # 游戏说明
│   ├── snake_game.py       # 主游戏文件
│   └── .python-version     # Python 版本指定
```

### 关键技术选型

- **Python 3.10+**: 现代Python版本，提供良好的语言特性
- **pygame**: 成熟的2D游戏开发库，跨平台支持良好，易于使用
- **uv**: 快速的Python包管理器，用于依赖管理和环境隔离

选型理由：
- pygame 是Python游戏开发的标准库，文档丰富，社区活跃
- uv 是新一代Python包管理工具，速度快，操作简单
- 不使用外部图片资源，降低复杂度和依赖

### 数据模型

**游戏状态：**
```python
class GameState:
    - snake: List[Position]  # 蛇的位置列表（头到尾）
    - direction: Direction   # 当前移动方向
    - food: Position         # 食物位置
    - score: int            # 当前分数
    - game_over: bool       # 游戏是否结束
```

**位置坐标：**
```python
class Position:
    - x: int  # 网格x坐标
    - y: int  # 网格y坐标
```

**方向枚举：**
```python
class Direction(Enum):
    UP, DOWN, LEFT, RIGHT
```

### 接口设计

**主要函数接口：**

- `init_game() -> GameState`: 初始化游戏
- `handle_input(event) -> Direction`: 处理键盘输入
- `update_game(state: GameState) -> GameState`: 更新游戏状态
- `check_collision(state: GameState) -> bool`: 检测碰撞
- `render(state: GameState)`: 渲染游戏画面
- `main()`: 主游戏循环

## 验收标准

### 功能验收

- [ ] 游戏能够正常启动，显示游戏窗口
- [ ] 蛇能够响应键盘输入，改变移动方向
- [ ] 蛇以恒定速度自动移动
- [ ] 蛇吃到食物后身体增长，分数增加
- [ ] 食物被吃后在新位置随机生成
- [ ] 蛇撞墙时游戏结束
- [ ] 蛇撞到自己时游戏结束
- [ ] 游戏结束时显示最终分数
- [ ] 所有游戏元素使用色块渲染，无图片资源
- [ ] 使用 `uv` 能够正确安装依赖和运行游戏

### 性能验收

- [ ] 游戏运行流畅，无明显卡顿
- [ ] 键盘响应及时，无延迟感
- [ ] 游戏启动时间在3秒以内

### 代码质量验收

- [ ] 代码结构清晰，易于理解
- [ ] 包含必要的注释
- [ ] README.md 包含清晰的运行说明

## 约束与限制

### 技术约束

- 必须使用 Python 开发
- 必须使用 `uv` 作为包管理工具
- 不能使用图片资源，只能使用色块
- 游戏必须简单，代码量控制在合理范围内（单文件不超过500行）

### 时间约束

- 作为简单示例项目，开发时间应控制在较短周期内

### 资源约束

- 项目为轻量级游戏，不应依赖大型库或框架
- 游戏包大小应尽量小

## 风险与回滚

### 潜在风险

| 风险 | 影响程度 | 发生概率 | 缓解措施 |
|------|---------|---------|---------|
| pygame 在某些系统上安装困难 | 中 | 低 | 提供详细的安装说明，考虑使用 pygame-ce (社区版) |
| uv 工具不熟悉导致配置错误 | 低 | 中 | 参考 uv 官方文档，使用标准配置 |
| 游戏在不同操作系统表现不一致 | 中 | 低 | 在多个平台测试，使用 pygame 的跨平台特性 |
| 性能问题（帧率不稳定） | 低 | 低 | 优化游戏循环，使用固定时间步长 |

### 回滚方案

由于这是新增功能，回滚方案相对简单：

**回滚步骤：**
1. 删除 `game` 目录及其所有内容
2. 如果修改了项目根目录的其他文件（如 README），恢复这些文件
3. 清理任何全局安装的依赖（如果有）

**回滚验证：**
- [ ] 确认 `game` 目录已完全删除
- [ ] 确认项目其他部分未受影响
- [ ] 确认没有遗留的配置文件或依赖

## 非目标

明确说明本需求不打算解决的问题：

- ❌ 不开发复杂的游戏引擎
- ❌ 不实现多种游戏类型
- ❌ 不开发游戏编辑器或关卡设计工具
- ❌ 不提供联机对战功能
- ❌ 不开发移动端或浏览器版本
- ❌ 不实现复杂的AI对手
- ❌ 不添加成就系统或社交功能
- ❌ 不进行游戏性能的极致优化

## 依赖关系

### 依赖的其他需求/系统

- Python 3.10+ 运行环境
- uv 包管理工具
- pygame 或类似的游戏开发库

### 被依赖的需求/系统

- 后续可能添加的其他小游戏可以参考此游戏的实现
- 可作为 Python 项目示例供学习参考

## 参考资料

- [pygame 官方文档](https://www.pygame.org/docs/)
- [uv 官方文档](https://github.com/astral-sh/uv)
- [Python 贪吃蛇游戏教程](https://realpython.com/pygame-a-primer/)
- 相关 Issue: #24

---

**审批记录**

| 审批人 | 角色 | 审批时间 | 审批意见 |
|-------|------|---------|---------|
| | | | |
