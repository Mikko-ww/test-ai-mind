# 执行计划模板

> **Parent Issue**: #[ISSUE_NUMBER]
> **创建时间**: [TIMESTAMP]
> **状态**: [draft/approved]

## 元信息

- **Parent Issue**: #[ISSUE_NUMBER]
- **Spec文档**: [链接到需求规格说明书]
- **总任务数**: [N]
- **当前状态**: [draft/approved]
- **最后更新**: [TIMESTAMP]

## 任务列表

本计划包含 [N] 个任务，按顺序执行。每个任务完成后才会开始下一个任务。

### 任务等级说明

- **l1 (自动合并)**: 仅修改文档、测试或其他安全路径，CI通过后自动合并
- **l2 (命令批准)**: CI通过后需要协作者使用 `/approve-task` 命令批准合并
- **l3 (人工审查)**: 需要完整的PR Review流程，可能涉及敏感文件或复杂变更

### 任务详情

| ID | 标题 | 等级 | 依赖 | 验收标准 |
|----|------|------|------|----------|
| task-1 | [任务标题] | l1/l2/l3 | [] | [验收标准] |
| task-2 | [任务标题] | l1/l2/l3 | [task-1] | [验收标准] |
| task-3 | [任务标题] | l1/l2/l3 | [task-2] | [验收标准] |

### YAML 机器契约（必须）

请确保 `plans/issue-[id].yaml` 使用固定 machine keys：

- 顶层必填：`tasks`
- task 必填：`id`, `title`, `level`, `deps`, `acceptance`
- 无依赖必须写 `deps: []`
- 运行态字段 `status`、`issue`、`pr` 由系统状态评论维护，禁止写入 plan YAML

最小合法示例：

```yaml
tasks:
  - id: task-setup-env
    title: "初始化项目环境"
    level: l1
    deps: []
    acceptance: "项目结构创建完成并可安装依赖"
    notes: "可选"
```

禁止键（命中即失败）：`dependencies`, `acceptance_criteria`, `risk_level` 以及中文键名（如 `依赖`, `验收标准`, `风险等级`）。

---

## 任务1: [任务标题]

**ID**: `task-1`  
**等级**: l1/l2/l3  
**状态**: draft  
**预估工作量**: Small/Medium/Large

### 描述

[详细描述任务要做什么]

### 验收标准

- [ ] [验收标准1]
- [ ] [验收标准2]
- [ ] [验收标准3]

### 依赖

- 依赖任务: [无 或 task-X]
- 前置条件: [列出前置条件]

### 实现要点

- [要点1]
- [要点2]
- [要点3]

### 测试要求

- [测试要求1]
- [测试要求2]

### 关联资源

- Runtime 状态：由 `<!-- agent-state:json -->` 维护

---

## 任务2: [任务标题]

[同上格式]

---

## 风险与注意事项

### 整体风险

- [风险1]
- [风险2]

### 关键路径

[标识出关键路径上的任务]

### 阻塞点

[可能的阻塞点和应对方案]

## 执行策略

### 串行执行

本计划采用严格串行执行策略：
- 同一时间只有一个任务处于 `in-progress` 状态
- 任务必须按照ID顺序执行
- 前一个任务完成并合并后，才会开始下一个任务

### 失败处理

如果任务失败：
1. 任务进入 `blocked` 状态
2. 系统等待人工介入（使用 `/retry` 命令重试或 `/abort` 终止）
3. 修复后可以继续执行

### 暂停/恢复

- 使用 `/pause` 命令暂停任务派发
- 使用 `/resume` 命令恢复任务派发
- 暂停期间不会创建新的任务PR

## 进度追踪

### 状态定义

- **pending**: 任务等待开始
- **in-progress**: 任务正在执行（Copilot已被分配）
- **in-review**: 任务PR已创建，等待审查/合并
- **blocked**: 任务被阻塞，需要人工介入
- **done**: 任务已完成并合并
- **cancelled**: 任务被取消

### 更新机制

本文档是计划定义文档；运行态（任务状态、Issue、PR）由 Epic Issue 下的状态评论维护。

---

**注意**: `plans/[issue-id].yaml` 仅用于定义任务。运行态请以 `<!-- agent-state:json -->` 为准。
