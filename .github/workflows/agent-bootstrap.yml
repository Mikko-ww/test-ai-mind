# ============================================================================
# Agent Bootstrap Workflow - 代理引导工作流
# ============================================================================
#
# 【工作流用途】
# 这个工作流用于初始化和引导 GitHub Agent 系统所需的所有标签（labels）。
# 它是一个维护工具，确保仓库中存在所有必需的 agent 标签。
#
# 【触发方式】
# - 手动触发（workflow_dispatch）：可以在 GitHub Actions 页面手动运行
# - 支持 dry_run 模式：仅检查不创建/更新标签
#
# 【主要功能】
# 1. 检查缺失的标签：扫描仓库，识别缺失的 agent 标签
# 2. 创建新标签：为不存在的标签创建新的标签
# 3. 更新现有标签：如果颜色或描述已更改，更新现有标签
# 4. 提供摘要报告：显示创建/更新/跳过的标签统计信息
#
# 【所需标签类型】
# - 生命周期标签：agent:requested, agent:spec-in-progress, agent:spec-approved 等
# - 任务状态标签：agent:task, agent:pending, agent:in-progress 等
# - 风险级别标签：agent:l1, agent:l2, agent:l3
# - PR 类型标签：agent:spec-pr, agent:plan-pr, agent:task-pr 等
#
# 【使用场景】
# - 首次设置 Agent 系统时
# - 升级 Agent 系统版本后
# - 标签被意外删除或修改后
# - 定期维护和验证标签完整性
#
# ============================================================================

name: Agent Bootstrap
run-name: "Agent Bootstrap • ${{ inputs.dry_run && 'Dry Run' || 'Live Run' }}"

# This workflow can be manually triggered to check and create all required labels
# It will:
# - Check for missing labels
# - Create any labels that don't exist
# - Update existing labels if colors or descriptions have changed
# - Provide a summary of created/updated/skipped labels

on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run mode (only check, do not create/update)'
        required: false
        type: boolean
        default: false

permissions:
  contents: read
  issues: write

jobs:
  bootstrap-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: cd .github/scripts && npm install

      - name: Bootstrap labels
        run: node .github/scripts/bootstrap-labels.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          DRY_RUN: ${{ inputs.dry_run }}
